!function(a,b){"use strict";var c=function(){this.initialize.apply(this,arguments)};c.prototype.initialize=function(){},c.extend=a.Model.extend,function(){var d=new Error("a serializer requires some attributes to be useful");a.Serializer=c.extend({attributes:[],relations:[],serializers:[],constructor:function(){if(c.prototype.constructor.apply(this,arguments),this.hasEmptyWhitelist())throw d;this.instanciateSerializers(),this.__whitelist=this.buildWhitelist()},serialize:function(a){var b=this.extractData(a);return this.applyRelations(b),this.applyHandlers(b),this.applySerializers(b),b},extractData:function(a){var c={};return b.each(this.__whitelist,function(b){c[b]=a.get(b)}),c},applyRelations:function(a){b.each(this.relations,function(b){a[b]&&(a[b]=a[b].toJSON())})},applySerializers:function(a){b.each(this.serializers,function(b,c){a[c]&&(a[c]=b.serialize(a[c]))})},applyHandlers:function(a){b.forOwn(a,function(b,c){a[c]=this[c]?this[c](b):b},this)},instanciateSerializers:function(){var a=this.serializers;b.forOwn(a,function(b,c){a[c]=new b})},buildWhitelist:function(){return[].concat(this.attributes,this.relations,b.keys(this.serializers))},hasEmptyWhitelist:function(){var a=[this.attributes,this.relations,this.serializers];return b.all(a,b.isEmpty)}})}(),function(){function d(a){var c=[a.attributes,a.relations,a.deserializers];return b.all(c,b.isEmpty)}function e(a){return!a.model&&!a.collection}function f(a){return[].concat(a.attributes,b.keys(a.relations),b.keys(a.deserializers))}function g(a){b.forOwn(a,function(b,c){a[c]=new b})}var h=new Error("A deserializer without attributes will not be terribly effective!"),i=new Error("A deserializer must have a model or a collection to instanciate");a.Deserializer=c.extend({attributes:[],relations:{},deserializers:{},constructor:function(){if(c.prototype.constructor.apply(this,arguments),d(this))throw h;if(e(this))throw i;this.__whitelist=f(this),g(this.deserializers)},deserialize:function(a){var b=this.onceOrMany("whitelistData",a);return this.onceOrMany("applyHandlers",b),this.onceOrMany("applyRelations",b),this.onceOrMany("applyDeserializers",b),this.instanciate(b)},onceOrMany:function(a,c){return b.isArray(c)?b.map(c,this[a],this):this[a](c)},whitelistData:function(a){return b.pick(a,this.__whitelist)},applyRelations:function(a){b.forOwn(a,function(b,c){var d=this.relations[c];d&&(a[c]=new d(b))},this)},applyDeserializers:function(a){b.forOwn(a,function(b,c){var d=this.deserializers[c];d&&(a[c]=d.deserialize(b))},this)},applyHandlers:function(a){b.forOwn(a,function(b,c){a[c]=this[c]?this[c](b):b},this)},instanciate:function(a){return b.isArray(a)&&this.collection?new this.collection(a):new this.model(a)}})}()}(Backbone,_);