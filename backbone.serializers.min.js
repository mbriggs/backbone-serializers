!function(a,b){"use strict";var c=a.Error.extend({name:"EmptyAttrsError",initialize:function(a){this.message="A "+a+" requires some attributes to be useful"}}),d=a.Error.extend({name:"NoModelError",message:"A deserializer must have a model or a collection to instanciate"});!function(){a.Serializer=a.Class.extend({attributes:[],relations:[],serializers:[],constructor:function(){if(this.initialize.apply(this,arguments),this.hasEmptyWhitelist())throw new c("serializer");this.instanciateSerializers(),this.__whitelist=this.buildWhitelist()},serialize:function(a){var b=this.extractData(a);return this.applyRelations(b),this.applyHandlers(b),this.applySerializers(b),b},extractData:function(a){var c={};return b.each(this.__whitelist,function(b){c[b]=a.get(b)}),c},applyRelations:function(a){b.each(this.relations,function(b){a[b]&&(a[b]=a[b].toJSON())})},applySerializers:function(a){b.each(this.serializers,function(b,c){a[c]&&(a[c]=b.serialize(a[c]))})},applyHandlers:function(a){b.forOwn(a,function(b,c){a[c]=this[c]?this[c](b):b},this)},instanciateSerializers:function(){var a=this.serializers;b.forOwn(a,function(b,c){a[c]=new b})},buildWhitelist:function(){return[].concat(this.attributes,this.relations,b.keys(this.serializers))},hasEmptyWhitelist:function(){var a=[this.attributes,this.relations,this.serializers];return b.all(a,b.isEmpty)}})}(),function(){function e(a){var c=[a.attributes,a.relations,a.deserializers];return b.all(c,b.isEmpty)}function f(a){return!a.model&&!a.collection}function g(a){return[].concat(a.attributes,b.keys(a.relations),b.keys(a.deserializers))}function h(a){b.forOwn(a,function(b,c){a[c]=new b})}a.Deserializer=a.Class.extend({__name__:"Deserializer",attributes:[],relations:{},deserializers:{},constructor:function(){if(this.initialize.apply(this,arguments),e(this))throw new c("deserializer");if(f(this))throw new d;this.__whitelist=g(this),h(this.deserializers)},deserialize:function(a){var b=this.onceOrMany("whitelistData",a);return this.onceOrMany("applyHandlers",b),this.onceOrMany("applyRelations",b),this.onceOrMany("applyDeserializers",b),this.instanciate(b)},onceOrMany:function(a,c){return b.isArray(c)?b.map(c,this[a],this):this[a](c)},whitelistData:function(a){return b.pick(a,this.__whitelist)},applyRelations:function(a){b.forOwn(a,function(b,c){var d=this.relations[c];d&&(a[c]=new d(b))},this)},applyDeserializers:function(a){b.forOwn(a,function(b,c){var d=this.deserializers[c];d&&(a[c]=d.deserialize(b))},this)},applyHandlers:function(a){b.forOwn(a,function(b,c){a[c]=this[c]?this[c](b):b},this)},instanciate:function(a){return b.isArray(a)&&this.collection?new this.collection(a):new this.model(a)}})}()}(Backbone,_);