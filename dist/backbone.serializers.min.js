!function(){var a=function(){this.initialize.apply(this,arguments)};a.prototype.initialize=function(){},a.extend=Backbone.Model.extend;var b=new Error("a serializer requires some attributes to be useful");Backbone.Serializer=a.extend({attributes:[],relations:[],serializers:[],constructor:function(){if(a.prototype.constructor.apply(this,arguments),this.hasEmptyWhitelist())throw b;this.instanciateSerializers(),this.__whitelist=this.buildWhitelist()},serialize:function(a){var b=this.extractData(a);return this.applyRelations(b),this.applyHandlers(b),this.applySerializers(b),b},extractData:function(a){var b={};return _.each(this.__whitelist,function(c){b[c]=a.get(c)}),b},applyRelations:function(a){_.each(this.relations,function(b){a[b]&&(a[b]=a[b].toJSON())})},applySerializers:function(a){_.each(this.serializers,function(b,c){a[c]&&(a[c]=b.serialize(a[c]))})},applyHandlers:function(a){_.forOwn(a,function(b,c){a[c]=this[c]?this[c](b):b},this)},instanciateSerializers:function(){var a=this.serializers;_.forOwn(a,function(b,c){a[c]=new b})},buildWhitelist:function(){return[].concat(this.attributes,this.relations,_.keys(this.serializers))},hasEmptyWhitelist:function(){var a=[this.attributes,this.relations,this.serializers];return _.all(a,_.isEmpty)}})}(),function(){function a(a){var b=[a.attributes,a.relations,a.deserializers];return _.all(b,_.isEmpty)}function b(a){return!a.model&&!a.collection}function c(a){return[].concat(a.attributes,_.keys(a.relations),_.keys(a.deserializers))}function d(a){_.forOwn(a,function(b,c){a[c]=new b})}var e=new Error("A deserializer without attributes will not be terribly effective!"),f=new Error("A deserializer must have a model or a collection to instanciate");Backbone.Deserializer=Class.extend({attributes:[],relations:{},deserializers:{},constructor:function(){if(Class.prototype.constructor.apply(this,arguments),a(this))throw e;if(b(this))throw f;this.__whitelist=c(this),d(this.deserializers)},deserialize:function(a){var b=this.onceOrMany("whitelistData",a);return this.onceOrMany("applyHandlers",b),this.onceOrMany("applyRelations",b),this.onceOrMany("applyDeserializers",b),this.instanciate(b)},onceOrMany:function(a,b){return _.isArray(b)?_.map(b,this[a],this):this[a](b)},whitelistData:function(a){return _.pick(a,this.__whitelist)},applyRelations:function(a){_.forOwn(a,function(b,c){var d=this.relations[c];d&&(a[c]=new d(b))},this)},applyDeserializers:function(a){_.forOwn(a,function(b,c){var d=this.deserializers[c];d&&(a[c]=d.deserialize(b))},this)},applyHandlers:function(a){_.forOwn(a,function(b,c){a[c]=this[c]?this[c](b):b},this)},instanciate:function(a){return _.isArray(a)&&this.collection?new this.collection(a):new this.model(a)}})}();